<template>
  <div class="md:container md:mx-auto">
    <div class="charts-map" ref="chartDomRef"></div>
  </div>
</template>

<script setup>
import { onMounted, ref } from 'vue';
import { IsMedia } from '../../utils/index';
import china from './china.json';

const chartDomRef = ref(null);

//https://www.google.com/maps æŸ¥è¯¢åæ ‡
let footprint = [
  [33.39076295809011, 109.8069952653452], //å•†æ´›
  [34.265088968502866, 108.95024945477402], //è¥¿å®‰ 2011
  [34.6096480104217, 108.48723804025089], //å’¸é˜³ 2017
  [30.608439333764853, 104.07191888366381], //æˆéƒ½ 2018
  [36.62606210846314, 101.78997595640057], //è¥¿å® 2019
  [36.91342612743801, 100.09243860466682], //é’æµ·æ¹–
  [34.75231283443789, 106.50461274792572], //å®é¸¡
  [33.11517652657251, 107.06296612985867], //æ±‰ä¸­ 2020
  [22.81804671389275, 108.36411157462854], //å—å® 2022
  [21.455419963427268, 109.1304633189505], //åŒ—æµ·
  [22.81975309557381, 106.82197859551223], //å´‡å·¦
  [36.071273927765375, 120.37562258224959], //é’å²› 2023
  [24.510927756330577, 117.65377366577064], //æ¼³å·ž
  [26.072603428811814, 119.29949096240252], //ç¦å·ž
  [24.494326102214718, 118.13967444423031], //åŽ¦é—¨
  [23.687177337241792, 117.43557011619761], //ä¸œå±±å²›
  [30.142162418139925, 118.17532735830969], //é»„å±±
  [22.32851658753095, 114.17575248396336], //é¦™æ¸¯
  [22.196944412030653, 113.54105162106022], //æ¾³é—¨
  [31.110815569285716, 102.90325641348434], //å››å§‘å¨˜å±± 2024
  [30.033013581829877, 101.9629193468851], //æœ¨æ ¼æŽª
  [30.009466813648647, 103.04416636409177], //é›…å®‰
  [36.919410544027315, 121.53716624090671], //ä¹³å±±å¸‚
  [37.51989232507069, 122.11106477078646], //å¨æµ·å¸‚
  [37.45932668985068, 121.45094555609734], //çƒŸå°å¸‚
  [43.828123127470654, 87.62111409309944], //ä¹Œé²æœ¨é½
  [44.37451021659652, 84.30455275210899], //ä¹Œè‹å¸‚
  [44.60632540263776, 81.3141822184842], //èµ›é‡Œæœ¨æ¹–
  [43.90957167943459, 81.27708645535601], //ä¼Šå®å¸‚
  [43.296820219101306, 84.23052379664968], //é‚£æ‹‰æ
  [37.557685602850796, 126.98442713920417], //é¦–å°”
  [35.18278033722124, 129.0707283203815], //é‡œå±±
  [29.65982937275121, 91.1343352335305], //æ‹‰è¨ 2025
  [29.65140657577963, 94.42049102820424], //æž—èŠ
  [30.73020860821244, 90.66478509108275], //çº³æœ¨é”™
  [30.007222171223457, 93.91370995734012], //å·´æ¾æŽª
  [29.61669037355501, 94.95108055049327], //é›…é²è—å¸ƒå¤§å³¡è°·
  [38.969572506315664, 113.60474325244523], //äº”å°å±±
  [39.181481129763895, 112.83399428740974], //é›é—¨å…³
  [37.37391788589756, 112.7785241263228], //å¹³é¥å¤åŸŽ
  [20.04547273820169, 110.197330933251], //æµ·å£
  [19.538837177926258, 110.79832188906887], //æ–‡æ˜Œ
  [18.794279133699312, 110.38895237776002], //ä¸‡å®
  [18.259724303447776, 109.50717220998865], //ä¸‰äºš
  [39.61126458838505, 109.77115986345035], //é„‚å°”å¤šæ–¯
  [46.07213257176879, 122.09551528943904], //ä¹Œå…°æµ©ç‰¹
  [47.28412015541581, 120.42260543002739], //é˜¿å°”å±±
  [49.59482280579526, 117.38222156320363], //æ»¡æ´²é‡Œ
  [49.22323271243972, 119.97967598358481], //å‘¼ä¼¦è´å°”
  // [35.67993607757777, 139.77121006698903], //ä¸œäº¬
  // [34.66938229659487, 135.5080069427568], //å¤§é˜ª
  // [33.50606889266476, 126.5193732438836], //æµŽå·ž
  // [-36.84841493203778, 174.77676976579397], //å¥¥å…°å…‹ 2026
  // [-41.28388247171658, 174.77295084610657], //æƒ çµé¡¿
];

footprint = footprint.map(([longitude, latitude]) => [latitude, longitude]);

const echartsDraw = async () => {
  const echarts = await import('echarts'); // ðŸ‘ˆ è¿™é‡ŒåŠ¨æ€å¼•å…¥
  echarts.registerMap('china', china);

  const chartDom = chartDomRef.value;
  const myChart = echarts.init(chartDom);
  chartDom.removeAttribute('_echarts_instance_');
  const frequencyScatter = footprint.map(item => ({ value: item }));
  const option = {
    title: {
      show: true,
      text: 'æˆ‘çš„è¶³è·¡',
      textStyle: {
        fontSize: 16,
        color: '#999',
      },
      left: 'center',
      top: '5%',
    },
    geo: {
      type: 'map',
      map: 'china',
      silent: true, //å–æ¶ˆé¼ æ ‡ç§»å…¥äº‹ä»¶

      // roam: true,
      zoom: 1.4,
      regions: [
        {
          name: 'å—æµ·è¯¸å²›',
          itemStyle: {
            // éšè—åœ°å›¾
            opacity: 0, // ä¸º 0 æ—¶ä¸ç»˜åˆ¶è¯¥å›¾å½¢
          },
          label: {
            show: false, // éšè—æ–‡å­—
          },
        },
      ],
      itemStyle: {
        areaColor: '#00000000', //rgbaè®¾ç½®é€æ˜Žåº¦0
        borderColor: localStorage.theme === 'light' ? '#666' : '#409EFF', //çœä»½è¾¹æ¡†é¢œè‰²
        borderWidth: IsMedia() === 'm' ? 0.1 : 0.3, //çœä»½è¾¹æ¡†
      },
    },
    series: [
      {
        data: frequencyScatter,
        type: 'effectScatter',
        coordinateSystem: 'geo',
        symbolSize: IsMedia() === 'm' ? 5 : 10,
        rippleEffect: {
          scale: IsMedia() === 'm' ? 3 : 5,
        },
      },
    ],
  };

  myChart.setOption(option);

  window.addEventListener('resize', function () {
    myChart.resize();
  });
};

onMounted(() => {
  if (typeof window !== 'undefined') {
    echartsDraw();
  }
});
</script>

<style scoped>
.charts-map {
  height: 65vw;
}

@media screen and (max-width: 768px) {
  .charts-map {
    height: 40vh;
  }
}
</style>
